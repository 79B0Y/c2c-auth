graph TB
    subgraph "语音助手平台"
        GA[Google Assistant]
        AA[Amazon Alexa]
    end
    
    subgraph "核心平台服务"
        KC[Keycloak<br/>身份认证中心]
        AG[SmartGateway<br/>Actix Web 服务]
        N8N[N8N<br/>工作流编排引擎]
    end
    
    subgraph "设备管理层"
        DS[DeviceHub<br/>设备域服务]
        LH[LocalExecutor<br/>本地执行器]
    end
    
    subgraph "存储与消息"
        PG[(PostgreSQL<br/>主数据库)]
        RD[(Redis<br/>缓存/会话)]
        NT[NATS<br/>消息队列]
        MQ[MQTT Broker<br/>设备消息]
    end
    
    subgraph "智能设备生态"
        LL[LinkLink 设备]
        ZB[Zigbee 设备]
        BT[蓝牙设备]
        WF[Wi-Fi 设备]
    end
    
    subgraph "运维与监控"
        CD[CDN<br/>静态资源]
        MON[监控告警系统]
        LOG[日志聚合]
    end
    
    GA -->|OAuth2.0/JWT| KC
    AA -->|OAuth2.0/JWT| KC
    KC -->|身份验证| AG
    AG -->|设备控制| DS
    AG -->|工作流触发| N8N
    
    DS -->|状态同步| PG
    DS -->|命令分发| NT
    DS -->|设备通信| MQ
    
    LH -->|本地执行| LL
    LH -->|本地执行| WF
    
    N8N -->|自动化| DS
    N8N -->|通知| AG
    
    AG -->|缓存| RD
    DS -->|设备状态| RD
    
    LL -->|协议适配| DS
    ZB -->|网关适配| DS
    BT -->|网关适配| DS
    WF -->|直连/网关| DS
